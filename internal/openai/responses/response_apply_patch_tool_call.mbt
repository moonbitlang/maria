///|
/// A tool call to apply a patch.
struct ResponseApplyPatchToolCall {
  /// The unique ID of the apply patch tool call.
  id : String
  /// The unique ID of the apply patch tool call generated by the model.
  call_id : String
  /// The operation applied via apply_patch.
  operation : ResponseApplyPatchToolCallOperation
  /// The status of the apply patch tool call.
  status : ResponseApplyPatchToolCallStatus
  /// The ID of the entity that created this tool call.
  created_by : String?
}

///|
enum ResponseApplyPatchToolCallOperation {
  CreateFile(ResponseApplyPatchToolCallOperationCreateFile)
  DeleteFile(ResponseApplyPatchToolCallOperationDeleteFile)
  UpdateFile(ResponseApplyPatchToolCallOperationUpdateFile)
}

///|
/// Instruction describing how to create a file via the apply_patch tool.
struct ResponseApplyPatchToolCallOperationCreateFile {
  /// Diff to apply.
  diff : String
  /// Path of the file to create.
  path : String
}

///|
/// Instruction describing how to delete a file via the apply_patch tool.
struct ResponseApplyPatchToolCallOperationDeleteFile {
  /// Path of the file to delete.
  path : String
}

///|
/// Instruction describing how to update a file via the apply_patch tool.
struct ResponseApplyPatchToolCallOperationUpdateFile {
  /// Diff to apply.
  diff : String
  /// Path of the file to update.
  path : String
}

///|
/// The status of the apply patch tool call.
enum ResponseApplyPatchToolCallStatus {
  InProgress
  Completed
}

///|
pub impl ToJson for ResponseApplyPatchToolCallStatus with to_json(
  self : ResponseApplyPatchToolCallStatus,
) -> Json {
  match self {
    InProgress => "in_progress"
    Completed => "completed"
  }
}

///|
pub impl @json.FromJson for ResponseApplyPatchToolCallStatus with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseApplyPatchToolCallStatus raise @json.JsonDecodeError {
  guard json is String(status_str) else {
    raise @json.JsonDecodeError(
      (path, "ResponseApplyPatchToolCallStatus: expected string"),
    )
  }
  match status_str {
    "in_progress" => InProgress
    "completed" => Completed
    _ =>
      raise @json.JsonDecodeError(
        (
          path,
          "ResponseApplyPatchToolCallStatus: invalid status '\{status_str}'",
        ),
      )
  }
}

///|
pub impl ToJson for ResponseApplyPatchToolCallOperationCreateFile with to_json(
  self : ResponseApplyPatchToolCallOperationCreateFile,
) -> Json {
  { "type": "create_file", "diff": self.diff, "path": self.path }
}

///|
pub impl @json.FromJson for ResponseApplyPatchToolCallOperationCreateFile with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseApplyPatchToolCallOperationCreateFile raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let diff : String = object.required("diff", path~)
  let path_value : String = object.required("path", path~)
  let _ : String = object.required("type", path~)
  ResponseApplyPatchToolCallOperationCreateFile::{ diff, path: path_value }
}

///|
pub impl ToJson for ResponseApplyPatchToolCallOperationDeleteFile with to_json(
  self : ResponseApplyPatchToolCallOperationDeleteFile,
) -> Json {
  { "type": "delete_file", "path": self.path }
}

///|
pub impl @json.FromJson for ResponseApplyPatchToolCallOperationDeleteFile with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseApplyPatchToolCallOperationDeleteFile raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let path_value : String = object.required("path", path~)
  let _ : String = object.required("type", path~)
  ResponseApplyPatchToolCallOperationDeleteFile::{ path: path_value }
}

///|
pub impl ToJson for ResponseApplyPatchToolCallOperationUpdateFile with to_json(
  self : ResponseApplyPatchToolCallOperationUpdateFile,
) -> Json {
  { "type": "update_file", "diff": self.diff, "path": self.path }
}

///|
pub impl @json.FromJson for ResponseApplyPatchToolCallOperationUpdateFile with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseApplyPatchToolCallOperationUpdateFile raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let diff : String = object.required("diff", path~)
  let path_value : String = object.required("path", path~)
  let _ : String = object.required("type", path~)
  ResponseApplyPatchToolCallOperationUpdateFile::{ diff, path: path_value }
}

///|
pub impl ToJson for ResponseApplyPatchToolCallOperation with to_json(
  self : ResponseApplyPatchToolCallOperation,
) -> Json {
  match self {
    CreateFile(op) => op.to_json()
    DeleteFile(op) => op.to_json()
    UpdateFile(op) => op.to_json()
  }
}

///|
pub impl @json.FromJson for ResponseApplyPatchToolCallOperation with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseApplyPatchToolCallOperation raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let type_str : String = object.required("type", path~)
  match type_str {
    "create_file" => {
      let op = @json.from_json(json, path~)
      CreateFile(op)
    }
    "delete_file" => {
      let op = @json.from_json(json, path~)
      DeleteFile(op)
    }
    "update_file" => {
      let op = @json.from_json(json, path~)
      UpdateFile(op)
    }
    _ =>
      raise @json.JsonDecodeError(
        (
          path.add_key("type"),
          "ResponseApplyPatchToolCallOperation: invalid type '\{type_str}'",
        ),
      )
  }
}

///|
pub impl ToJson for ResponseApplyPatchToolCall with to_json(
  self : ResponseApplyPatchToolCall,
) -> Json {
  let obj : Map[String, Json] = {
    "type": "apply_patch_call",
    "id": self.id,
    "call_id": self.call_id,
    "operation": self.operation,
    "status": self.status,
  }
  if self.created_by is Some(created_by) {
    obj["created_by"] = created_by.to_json()
  }
  Json::object(obj)
}

///|
pub impl @json.FromJson for ResponseApplyPatchToolCall with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseApplyPatchToolCall raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let id : String = object.required("id", path~)
  let call_id : String = object.required("call_id", path~)
  let operation : ResponseApplyPatchToolCallOperation = object.required(
    "operation",
    path~,
  )
  let status : ResponseApplyPatchToolCallStatus = object.required(
    "status",
    path~,
  )
  let _ : String = object.required("type", path~)
  let created_by : String? = object.optional("created_by", path~)
  ResponseApplyPatchToolCall::{ id, call_id, operation, status, created_by }
}
