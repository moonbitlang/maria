///|
/// A tool call to run a shell command.
struct ResponseFunctionShellToolCall {
  /// The unique ID of the shell tool call.
  id : String
  /// The shell commands and limits that describe how to run the tool call.
  action : ResponseFunctionShellToolCallAction
  /// The unique ID of the shell tool call generated by the model.
  call_id : String
  /// The status of the shell call.
  status : ResponseFunctionShellToolCallStatus
  /// The ID of the entity that created this tool call.
  created_by : String?
}

///|
/// The shell commands and limits that describe how to run the tool call.
struct ResponseFunctionShellToolCallAction {
  /// The shell commands to run for this tool call.
  commands : Array[String]
  /// Optional maximum number of characters to return from each command.
  max_output_length : Int64
  /// Optional timeout in milliseconds for the commands.
  timeout_ms : Int64
}

///|
/// The status of the shell call.
enum ResponseFunctionShellToolCallStatus {
  InProgress
  Completed
  Incomplete
}

///|
pub impl ToJson for ResponseFunctionShellToolCallStatus with to_json(
  self : ResponseFunctionShellToolCallStatus,
) -> Json {
  match self {
    InProgress => "in_progress"
    Completed => "completed"
    Incomplete => "incomplete"
  }
}

///|
pub impl @json.FromJson for ResponseFunctionShellToolCallStatus with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseFunctionShellToolCallStatus raise @json.JsonDecodeError {
  guard json is String(status_str) else {
    raise @json.JsonDecodeError(
      (path, "ResponseFunctionShellToolCallStatus: expected string"),
    )
  }
  match status_str {
    "in_progress" => InProgress
    "completed" => Completed
    "incomplete" => Incomplete
    _ =>
      raise @json.JsonDecodeError(
        (
          path,
          "ResponseFunctionShellToolCallStatus: invalid status '\{status_str}'",
        ),
      )
  }
}

///|
pub impl ToJson for ResponseFunctionShellToolCallAction with to_json(
  self : ResponseFunctionShellToolCallAction,
) -> Json {
  {
    "commands": self.commands,
    "max_output_length": @jsonx.int64(self.max_output_length),
    "timeout_ms": @jsonx.int64(self.timeout_ms),
  }
}

///|
pub impl @json.FromJson for ResponseFunctionShellToolCallAction with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseFunctionShellToolCallAction raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let commands : Array[String] = object.required("commands", path~)
  let max_output_length = object.required_int64("max_output_length", path~)
  let timeout_ms = object.required_int64("timeout_ms", path~)
  ResponseFunctionShellToolCallAction::{
    commands,
    max_output_length,
    timeout_ms,
  }
}

///|
pub impl ToJson for ResponseFunctionShellToolCall with to_json(
  self : ResponseFunctionShellToolCall,
) -> Json {
  let obj : Map[String, Json] = {
    "type": "shell_call",
    "id": self.id,
    "action": self.action,
    "call_id": self.call_id,
    "status": self.status,
  }
  if self.created_by is Some(created_by) {
    obj["created_by"] = created_by.to_json()
  }
  Json::object(obj)
}

///|
pub impl @json.FromJson for ResponseFunctionShellToolCall with from_json(
  json : Json,
  path : @json.JsonPath,
) -> ResponseFunctionShellToolCall raise @json.JsonDecodeError {
  let object = @jsonx.as_object(json, path~)
  let id : String = object.required("id", path~)
  let action : ResponseFunctionShellToolCallAction = object.required(
    "action",
    path~,
  )
  let call_id : String = object.required("call_id", path~)
  let status : ResponseFunctionShellToolCallStatus = object.required(
    "status",
    path~,
  )
  let _ : String = object.required("type", path~)
  let created_by : String? = object.optional("created_by", path~)
  ResponseFunctionShellToolCall::{ id, action, call_id, status, created_by }
}
